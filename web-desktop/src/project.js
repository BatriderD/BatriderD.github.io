window.__require=function t(e,s,i){function o(c,r){if(!s[c]){if(!e[c]){var l=c.split("/");if(l=l[l.length-1],!e[l]){var a="function"==typeof __require&&__require;if(!r&&a)return a(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+c+"'")}}var h=s[c]={exports:{}};e[c][0].call(h.exports,function(t){return o(e[c][1][t]||t)},h,h.exports,t,e,s,i)}return s[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<i.length;c++)o(i[c]);return o}({game:[function(t,e,s){"use strict";cc._RF.push(e,"e7221uYqfhBVq0WgyCCZpyq","game"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],map:[function(t,e,s){"use strict";cc._RF.push(e,"2c88133kjlG8ZSJpjIfiHfi","map");var i=cc.Enum({NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4});cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab},endPointPrefab:{default:null,type:cc.Prefab}},onLoad:function(){this.starCount=9,this.initMap(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this._onKeyPressed,this)},_onKeyPressed:function(t){var e=cc.v2(this._player.x+.5,this._player.y+.5),s=this.getTilePos(e),o=this.getTilePos(e);console.log("im_newTile"+o.x+" "+o.y);i.NONE;switch(t.keyCode){case cc.macro.KEY.up:case cc.macro.KEY.w:console.log("\u4e0a"),o.y-=1,i.DOWN;break;case cc.macro.KEY.down:case cc.macro.KEY.s:console.log("\u4e0b"),o.y+=1,i.UP;break;case cc.macro.KEY.left:case cc.macro.KEY.a:console.log("\u5de6"),o.x-=1,i.RIGHT;break;case cc.macro.KEY.right:case cc.macro.KEY.d:console.log("\u53f3"),o.x+=1,i.LEFT;break;default:console.log("\u5176\u4ed6"),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this._onKeyPressed,this);var n=this;return void Alert.show("\u6682\u505c",function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,n._onKeyPressed,n),console.log("\u53d6\u6d88\u6682\u505c")},!1)}this.moveToNewTilePos(s,o)},initMap:function(){this._player=cc.instantiate(this.playerPrefab),this._endgate=cc.instantiate(this.endPointPrefab),this.node.addChild(this._player),this.node.addChild(this._endgate),this._tiledMap=this.node.getComponent("cc.TiledMap"),this.mapSize=this._tiledMap.node.getContentSize(),console.log("_tiledMapSize"+this.mapSize.width+" height"+this.mapSize.height),this._layerFloor=this._tiledMap.getLayer("ground"),this._barriers=this._tiledMap.getLayer("barriers"),this._stars=this._tiledMap.getLayer("stars"),this._fire=this._tiledMap.getLayer("fire"),this._step=this._fire.getTileGIDAt(cc.v2(0,0)),this._fire.setTileGIDAt(0,0,0),console.log("_starts"+this._starts),this.changePlayerSize();var t=this._tiledMap.getObjectGroup("players");console.log("objGroup"+t),this._start=t.getObject("startPoint"),this._end=t.getObject("endPoint"),console.log("startPoint\u50cf\u7d20\u4f4d\u7f6e   x->"+this._start.x+" Y->"+this._start.y),console.log("endPoint\u50cf\u7d20\u4f4d\u7f6e     x->"+this._end.x+" Y->"+this._end.y);cc.v2(this._end.x,this._end.y);this.endTilePos=this.getTilePos(this._end),console.log("end\u50cf\u7d20\u5750\u6807\uff1a"+this._end.x+"y"+this._end.y),console.log("end\u74e6\u7247\u5750\u6807\uff1a"+this.endTilePos.x+"y"+this.endTilePos.y),this._tiledTip=this.getTilePos(this._start),console.log("\u5f00\u59cb\u74e6\u7247\u5750\u6807"+this._tiledTip.x+" Y"+this._tiledTip.y),console.log("\u5f00\u59cb\u50cf\u7d20\u5750\u6807"+this._start.x+"Y"+this._start.y),this.moveToNewTilePos(null,this._tiledTip),this._endgate.setPosition(cc.v2(this._end.x,this._end.y))},changePlayerSize:function(){var t=this._tiledMap.getTileSize();this._player.setContentSize(t.width,t.height),this._endgate.setContentSize(t.width,t.height)},getTilePos:function(t){var e=this._tiledMap.getTileSize(),s=Math.floor(t.x/e.width),i=Math.floor((this.mapSize.height-t.y)/e.height);return cc.v2(s,i)},getPixelPos:function(t){return this._layerFloor.getPositionAt(t)},moveToNewTilePos:function(t,e){var s=this.getPixelPos(e);this.success(e),this.canMove(e)&&(this._player.setPosition(s),this.eatStart(e),this._tiledTip=e,console.log("\u6211\u79fb\u52a8\u4e86\u65b0\u4f4d\u7f6e x\uff1a"+this._tiledTip.x+" y:"+this._tiledTip.y),null!=t&&this.showStep(this._fire,t,this._step))},showStep:function(t,e,s){t.setTileGIDAt(s,e.x,e.y),console.log("\u8bbe\u7f6e\u8db3\u8ff9 x:"+e.x+" y:"+e.y)},eatStart:function(t){var e=this._stars.getTileGIDAt(t);console.log("\u8e29\u5230\u4e86"+e),0!=e&&(this._stars.setTileGIDAt(0,t.x,t.y),console.log("\u8e29\u5230\u4e86\u5220\u9664"+t.x+" y:"+t.y),this.starCount--)},canMove:function(t){var e=this.getPixelPos(t);return console.log("\u6b64\u8def\u901a\u5f80\uff1a"+t.x+" Y"+t.y),e.x<0||e.x>this.mapSize.width?(console.log("\u6b64\u8def\u4e0d\u901a!\u5de6\u53f3"),!1):e.y<0||e.y>this.mapSize.height?(console.log("\u6b64\u8def\u4e0d\u901a!\u4e0a\u4e0b"),!1):0!=this._barriers.getTileGIDAt(t)?(console.log("\u6b64\u8def\u4e0d\u901a!\u969c\u788d"),!1):0!=this._fire.getTileGIDAt(t)?(console.log("\u6b64\u8def\u4e0d\u901a!\u8d70\u8fc7\u4e86"),!1):(console.log("\u6b64\u8def\u7545\u901a!"),!0)},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this._onKeyPressed,this)},success:function(t){if(t.x==this.endTilePos.x&&t.y==this.endTilePos.y){var e=this;0==this.starCount?Alert.show("\u4f60\u8d62\u4e86~",function(){e.restart(),cc.log("\u786e\u5b9a\u6309\u94ae\u88ab\u70b9\u51fb\uff01")},!1):Alert.show("\u4f60\u4ee5\u4e3a\u4f60\u8d62\u4e86\uff1f\u5269\u4f59\u661f\u661f\u6570\uff1a"+this.starCount,function(){e.restart(),cc.log("\u786e\u5b9a\u6309\u94ae\u88ab\u70b9\u51fb\uff01")},!1)}},restart:function(){this.initMap(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this._onKeyPressed,this)}}),cc._RF.pop()},{}],player:[function(t,e,s){"use strict";cc._RF.push(e,"f5c25JmbvdM9aplGVuX89Qj","player"),cc.Class({extends:cc.Component,properties:{particle:cc.Node},onLoad:function(){this.particle.getComponent(cc.ParticleSystem).resetSystem()},start:function(){}}),cc._RF.pop()},{}]},{},["game","map","player"]);