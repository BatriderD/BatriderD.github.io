window.__require=function e(t,i,s){function o(c,l){if(!i[c]){if(!t[c]){var r=c.split("/");if(r=r[r.length-1],!t[r]){var a="function"==typeof __require&&__require;if(!l&&a)return a(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+c+"'")}}var h=i[c]={exports:{}};t[c][0].call(h.exports,function(e){return o(t[c][1][e]||e)},h,h.exports,e,t,i,s)}return i[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<s.length;c++)o(s[c]);return o}({map:[function(e,t,i){"use strict";cc._RF.push(t,"2c88133kjlG8ZSJpjIfiHfi","map");var s=cc.Enum({NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4});cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab}},onLoad:function(){this.initMap(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this._onKeyPressed,this)},_onKeyPressed:function(e){var t=cc.v2(this._player.x+.5,this._player.y+.5),i=this.getTilePos(t),o=this.getTilePos(t);console.log("im_newTile"+o.x+" "+o.y);s.NONE;switch(e.keyCode){case cc.macro.KEY.up:case cc.macro.KEY.w:console.log("\u4e0a"),o.y-=1,s.DOWN;break;case cc.macro.KEY.down:case cc.macro.KEY.s:console.log("\u4e0b"),o.y+=1,s.UP;break;case cc.macro.KEY.left:case cc.macro.KEY.a:console.log("\u5de6"),o.x-=1,s.RIGHT;break;case cc.macro.KEY.right:case cc.macro.KEY.d:console.log("\u53f3"),o.x+=1,s.LEFT;break;default:return void console.log("\u5176\u4ed6")}this.moveToNewTilePos(i,o)},initMap:function(){this._player=cc.instantiate(this.playerPrefab),this.node.addChild(this._player),this._tiledMap=this.node.getComponent("cc.TiledMap"),this.mapSize=this._tiledMap.node.getContentSize(),console.log("_tiledMapSize"+this.mapSize.width+" height"+this.mapSize.height),this._layerFloor=this._tiledMap.getLayer("ground"),this._barriers=this._tiledMap.getLayer("barriers"),this._stars=this._tiledMap.getLayer("stars"),this._fire=this._tiledMap.getLayer("fire"),this._step=this._fire.getTileGIDAt(cc.v2(0,0)),console.log("_starts"+this._starts),this.changePlayerSize();var e=this._tiledMap.getObjectGroup("players");console.log("objGroup"+e),this._start=e.getObject("startPoint"),this._end=e.getObject("endPoint"),console.log("startPoint\u50cf\u7d20\u4f4d\u7f6e   x->"+this._start.x+" Y->"+this._start.y),console.log("endPoint\u50cf\u7d20\u4f4d\u7f6e     x->"+this._end.x+" Y->"+this._end.y);cc.v2(this._end.x,this._end.y);this.endTilePos=this.getTilePos(this._end),console.log("end\u50cf\u7d20\u5750\u6807\uff1a"+this._end.x+"y"+this._end.y),console.log("end\u74e6\u7247\u5750\u6807\uff1a"+this.endTilePos.x+"y"+this.endTilePos.y),this._tiledTip=this.getTilePos(this._start),console.log("\u5f00\u59cb\u74e6\u7247\u5750\u6807"+this._tiledTip.x+" Y"+this._tiledTip.y),console.log("\u5f00\u59cb\u50cf\u7d20\u5750\u6807"+this._start.x+"Y"+this._start.y),this.moveToNewTilePos(null,this._tiledTip)},changePlayerSize:function(){var e=this._tiledMap.getTileSize();this._player.setContentSize(e.width,e.height)},getTilePos:function(e){var t=this._tiledMap.getTileSize(),i=Math.floor(e.x/t.width),s=Math.floor((this.mapSize.height-e.y)/t.height);return cc.v2(i,s)},getPixelPos:function(e){return this._layerFloor.getPositionAt(e)},moveToNewTilePos:function(e,t){var i=this.getPixelPos(t);this.success(t),this.canMove(t)&&(this._player.setPosition(i),this.eatStart(t),this._tiledTip=t,console.log("\u6211\u79fb\u52a8\u4e86\u65b0\u4f4d\u7f6e x\uff1a"+this._tiledTip.x+" y:"+this._tiledTip.y),null!=e&&this.showStep(this._fire,e,this._step))},showStep:function(e,t,i){e.setTileGIDAt(i,t.x,t.y),console.log("\u8bbe\u7f6e\u8db3\u8ff9 x:"+t.x+" y:"+t.y)},eatStart:function(e){var t=this._stars.getTileGIDAt(e);console.log("\u8e29\u5230\u4e86"+t),0!=t&&(this._stars.setTileGIDAt(0,e.x,e.y),console.log("\u8e29\u5230\u4e86\u5220\u9664"+e.x+" y:"+e.y))},canMove:function(e){var t=this.getPixelPos(e);return console.log("\u6b64\u8def\u901a\u5f80\uff1a"+e.x+" Y"+e.y),t.x<0||t.x>this.mapSize.width?(console.log("\u6b64\u8def\u4e0d\u901a!\u5de6\u53f3"),!1):t.y<0||t.y>this.mapSize.height?(console.log("\u6b64\u8def\u4e0d\u901a!\u4e0a\u4e0b"),!1):0!=this._barriers.getTileGIDAt(e)?(console.log("\u6b64\u8def\u4e0d\u901a!\u969c\u788d"),!1):0!=this._fire.getTileGIDAt(e)?(console.log("\u6b64\u8def\u4e0d\u901a!\u8d70\u8fc7\u4e86"),!1):(console.log("\u6b64\u8def\u7545\u901a!"),!0)},onDestroy:function(){},success:function(e){e.x==this.endTilePos.x&&e.y==this.endTilePos.y&&console.log("\u901a\u5173")}}),cc._RF.pop()},{}],player:[function(e,t,i){"use strict";cc._RF.push(t,"f5c25JmbvdM9aplGVuX89Qj","player"),cc.Class({extends:cc.Component,properties:{particle:cc.Node},onLoad:function(){this.particle.getComponent(cc.ParticleSystem).resetSystem()},start:function(){}}),cc._RF.pop()},{}]},{},["map","player"]);